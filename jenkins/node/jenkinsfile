pipeline {

    // agent node
    agent { 
        node {
            label 'node-2'
            }
      }
   
        // build stage 
        stages {


            // Changing directory
            stage('Change Directory') {
                steps {
                    echo "Changing Directory.."
                    sh '''
                        cd jenkins/node
                        pwd
                    '''
                }
                
            }


            // Building
            stage('Build') {
                steps {
                    echo "Building.."
                    sh '''
                        pwd
                         cd jenkins/node 
                        npm install 
                    '''
                }
            }

            // run stage
            stage('Run') {
                steps {
                    echo "Run.."
                    sh 'node app.js & sleep 1'
                    sh 'echo $! > .pidfile'
                    sh 'kill $(cat .pidfile)'
                }
            }

            // Delete the workspace from the previous build
            stage('Cleanup Workspace') {
                steps {
                
                    deleteDir()
                }
            }

    }


    // post
    post {
        success {
            echo 'Build successful!'
        }
    
        failure {
            echo 'Build failed. Please check the logs for details.'
        }
    }
}